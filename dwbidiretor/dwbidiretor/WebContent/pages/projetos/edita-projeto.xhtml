<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:adm="http://github.com/adminfaces"
	template="/WEB-INF/templates/template.xhtml">

	<ui:define name="title">
        Cadastro Projeto
    </ui:define>
    
    <ui:define name="head-end">
    
 	<style type="text/css">
 	
	div.timeline-frame {  
        border-color: #dfe1e4;  
        border-radius: 5px;  
    }  
 
    div.timeline-axis {  
        border-color: #dfe1e4;  
        background-color: #dfe1e4;  
        filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#5D99C3', endColorstr='#3A6DA0') alpha(opacity = 100);  
        background: -webkit-gradient(linear, left top, left bottom, from(#5D99C3), to(#3A6DA0));  
        background: -moz-linear-gradient(top,  #5D99C3,  #3A6DA0);  
        -khtml-opacity: 1;  
        -moz-opacity: 1;  
        opacity: 1;  
    }  
 
    div.timeline-groups-axis {  
        border-color: #5D99C3;  
    }  
 
    div.timeline-groups-axis-onleft {  
        border-style: none solid none none;  
    }  
 
    div.timeline-axis-text {  
        color: white;  
    }  
 
    div.timeline-event {  
        color: white !important;  
        border-radius: 5px !important;  
    }  
 
    div.timeline-event-content {  
        padding: 5px;  
        text-shadow: none;  
    }  
 
    div.atrasado {  
        background: #f03030eb none !important;  /* red */  
        border-color: #bd2828 !important;     /* red */  
    }  
 
    div.andamento {  
        background: #1aa11a none !important;  /* green */  
        border-color: #136e13 !important;     /* green */  
    }  
 
    div.cancelado {  
        background: #f39c12 none !important;  /* orange */  
        border-color: #cc8100 !important;     /* orange */  
    }  
    
    div.aberto {  
        background: #1f89ce none !important;  /* blue */  
        border-color: #156090 !important;     /* blue */  
    }
    
    div.concluido {  
        background: #00c0ef none !important;  /* blue */  
        border-color: #156090 !important;     /* blue */  
    }
    
    
    
    div.atrasado_etapa_item {  
        background: #f0303099 none !important;  /* red */  
        border-color: #bd2828 !important;     /* red */  
    }  
 
    div.andamento_etapa_item {  
        background: #1aa11aa8 none !important;  /* green */  
        border-color: #136e13 !important;     /* green */  
    }  
 
    div.cancelado_etapa_item {  
        background: #ffa500b3 none !important;  /* orange */  
        border-color: #cc8100 !important;     /* orange */  
    }
     div.aberto_etapa_item {  
        background: #4face7 none !important;  /* blue */  
        border-color: #156090 !important;     /* blue */  
    }
    
    div.concluido_etapa_item {  
        background: #aaddffdb none !important;  /* blue */  
        border-color: #156090 !important;     /* blue */  
    }
 
    div.timeline-event-selected {  
        background: #BECEFE none !important;  
        border-color: #97B0F8 !important;  
    } 
      
</style>   
    
    </ui:define>
    
	<ui:define name="body">
	
		<f:metadata>
		</f:metadata>

		<adm:breadcrumb title="Cadastro Projeto" />
		<p:panel>
			<h:form id="form">
				<p:growl id="erros" showDetail="true" sticky="false" />
				<div class="box box-primary">
					<p:panelGrid columns="12" id="paineld" style="font-style: italic; font-size: 12px;"
						columnClasses="ui-grid-col-1,ui-grid-col-2,ui-grid-col-1,ui-grid-col-1,ui-grid-col-1,ui-grid-col-1,ui-grid-col-1,ui-grid-col-1,ui-grid-col-1,ui-grid-col-1,ui-grid-col-1,ui-grid-col-2"
						layout="grid" styleClass="ui-fluid card">


						<p:outputLabel value="Nome:" for="nome" />
						<p:inputText id="nome" value="#{beanEditaProjeto.projeto.nome}"  autocomplete="off"
							required="true" onkeyup="this.value=this.value.toUpperCase()" />

						<p:outputLabel value="Data Cadastro:" for="dtcadastro" />
						<p:calendar autocomplete="#{beanEditaProjeto.data}" locale="pt_BR"
							id="dtcadastro" disabled="true"
							value="#{beanEditaProjeto.projeto.dtcadastro}" pattern="dd/MM/yyyy"
							mask="true" required="true" />

						<p:outputLabel value="Data Inicio:" for="dtinicio" />
						<p:calendar locale="pt_BR" id="dtinicio" readonlyInput="true"
							value="#{beanEditaProjeto.projeto.dtinicio}" pattern="dd/MM/yyyy"
							mask="true" required="true">
							
						</p:calendar>

						<p:outputLabel value="Data Prevista:" for="dtprevista" />
						<p:calendar locale="pt_BR" id="dtprevista" readonlyInput="true"
							value="#{beanEditaProjeto.projeto.dtprevista}" pattern="dd/MM/yyyy"
							mask="true" required="true">
							
						</p:calendar>

						<p:outputLabel value="Data Conclusão" for="dtconclusao" />
						<p:calendar locale="pt_BR" id="dtconclusao" disabled="true"
							value="#{beanEditaProjeto.projeto.dtconclusao}" pattern="dd/MM/yyyy"
							mask="true" required="true" />

						<p:outputLabel value="Status:" for="status" />
						<p:inputText id="status" value="#{beanEditaProjeto.projeto.status}"
							required="true" disabled="true" />
					</p:panelGrid>

					<p:panelGrid columns="2" id="paineld2" style="font-style: italic; font-size: 12px;"
						columnClasses="ui-grid-col-1,ui-grid-col-12" layout="grid"
						styleClass="ui-fluid card">

						<p:outputLabel value="Descrição:" for="descricao" />
						<p:inputTextarea id="descricao" rows="02" required="true"
							onkeyup="this.value=this.value.toUpperCase()"
							style="width: 100% !important;"
							value="#{beanEditaProjeto.projeto.descricao}" autoResize="false" />

					</p:panelGrid>


					<p:commandButton id="nve" icon="fa fa-plus"
						styleClass="btn-primary"
						style="margin-top: 10px; horizontal-align:left;"
						action="#{beanEditaProjeto.addEtapa()}"
						oncomplete="PF('dialogp').show()" update=":form:dlg">
						<f:setPropertyActionListener target="#{beanEditaProjeto.etapa.projeto}"
							value="#{beanEditaProjeto.projeto}" />
					</p:commandButton>

					<div class="row">
						<div class="col-md-12">
							<div class="box box-info">
								<h:panelGrid columns="1" id="paineld3"
									columnClasses="left,right" width="100%" >

									<p:dataTable id="tabela" value="#{beanEditaProjeto.listaetapas}"
										var="etapas" editable="true" editMode="cell"  
										widgetVar="etapas" draggableRows="true" style="font-style: italic; font-size: 12px;"
										sortBy="#{etapas.ordenacao}">

										<p:ajax event="rowReorder"
											listener="#{beanEditaProjeto.onRowReorder}"
											update=":form:paineld3" />

										<f:facet name="header">Etapas</f:facet>
										
										<p:column headerText="Nome" width="10%">#{etapas.nome}</p:column>
										<p:column headerText="Autoridade" width="5%">#{etapas.autoridade}</p:column>
										<p:column headerText="Responsabilidade" width="7%">#{etapas.responsabilidade}</p:column>
										<p:column headerText="Cadastro" width="5%" >
											<h:outputText value="#{etapas.dtcadastro}">
												<f:convertDateTime pattern="dd/MM/yyyy" />
											</h:outputText>
										</p:column>
										<p:column headerText="Inicio" width="4%">
											<h:outputText value="#{etapas.dtinicio}">
												<f:convertDateTime pattern="dd/MM/yyyy" />
											</h:outputText>
										</p:column>
										<p:column headerText="Previsão" width="4%">
											<h:outputText value="#{etapas.dtprevista}">
												<f:convertDateTime pattern="dd/MM/yyyy" />
											</h:outputText>
										</p:column>
										<p:column headerText="Conclusão" width="4%">
											<h:outputText value="#{etapas.dtconclusao}">
												<f:convertDateTime pattern="dd/MM/yyyy" />
											</h:outputText>
										</p:column>
										<p:column headerText="Status" width="5%" ><span class="#{etapas.status == 'ABERTO' ? 'label label-primary' : null or etapas.status == 'CONCLUIDO' ? 'label label-info' : null or etapas.status == 'ANDAMENTO' ? 'label label-success' : null or etapas.status == 'CANCELADO' ? 'label label-warning' : null or etapas.status == 'ATRASADO' ? 'label label-danger' : null}" >#{etapas.status}</span></p:column>

										<p:column width="3%" headerText="#"
											style="text-align:center">
											<p:commandButton action="#{beanEditaProjeto.remove()}"
												ajax="false" immediate="true" partialSubmit="true"
												process="@this" oncomplete="#{beanEditaProjeto.listaetapas}"
												icon="fa fa-trash" styleClass="btn-danger btn-xs"
												onclick="if(!confirm('Confirma a exclusão ?')) return false;">
												<f:setPropertyActionListener value="#{etapas}"
													target="#{beanEditaProjeto.etapa}" />
											</p:commandButton>

											<p:commandButton oncomplete="PF('dialogp').show();"
												update=":form:dlg" icon="fa fa-edit"
												styleClass="btn-warning btn-xs">
												<f:setPropertyActionListener value="#{etapas}"
													target="#{beanEditaProjeto.etapa}" />
											</p:commandButton>
 
											<p:commandButton icon="fa fa-plus" 
												styleClass="btn-info btn-xs" actionListener="#{beanEditaProjeto.addEtapaItem(etapas)}"
												oncomplete="PF('dialogp2').show()" update=":form:dlg2">
											</p:commandButton>
										</p:column>

										<p:column headerText="Items da Etapa">											
											<p:dataTable value="#{etapas.items}"  var="items" widgetVar="items" draggableRows="false"
												sortBy="#{items.ordenacao}" style="font-style: italic; font-size: 12px;">
												
												<p:column headerText="#" width="4%" rendered="false">#{items.ordenacao}</p:column>
												<p:column headerText="Responsável" width="11%">#{items.responsavel}</p:column>
												<p:column headerText="Descrição">#{items.descricao}</p:column>

												<p:column headerText="Previsto" width="6%">#{items.valorprevisto}</p:column>
												<p:column headerText="Real" width="6%">#{items.valorconcluido}</p:column>
												
												<p:column headerText="Cadastro" width="9%">
													<h:outputText value="#{items.dtcadastro}">
														<f:convertDateTime pattern="dd/MM/yyyy" />
													</h:outputText>
												</p:column>
												<p:column headerText="Inicio" width="9%">
													<h:outputText value="#{items.dtinicio}">
														<f:convertDateTime pattern="dd/MM/yyyy" />
													</h:outputText>
												</p:column>
												<p:column headerText="Previsão" width="9%">
													<h:outputText value="#{items.dtprevista}">
														<f:convertDateTime pattern="dd/MM/yyyy" />
													</h:outputText>
												</p:column>
												<p:column headerText="Conclusão" width="9%">
													<h:outputText value="#{items.dtconclusao}">
														<f:convertDateTime pattern="dd/MM/yyyy" />
													</h:outputText>
												</p:column>
												<p:column headerText="Status" width="10%">#{items.status}</p:column>
												<p:column headerText="Observação" width="10%">#{items.statusobservacao}</p:column>

												<p:column width="6%" headerText="#"
													style="text-align:center">
													<p:commandButton action="#{beanEditaProjeto.removeItem()}" id="removeitem"
														ajax="false" immediate="true" partialSubmit="true"
														process="@this" oncomplete="#{beanEditaProjeto.etapa.items}"
														icon="fa fa-trash" styleClass="btn-danger btn-xs"
														onclick="if(!confirm('Confirma a exclusão ?')) return false;">
														<f:setPropertyActionListener value="#{items}"
															target="#{beanEditaProjeto.item}" />
													</p:commandButton>
													<p:tooltip for="removeitem" value="Excluir Item da Etapa" position="right" showEffect="clip" hideEffect="fold"/>

													<p:commandButton oncomplete="PF('dialogp2').show();" id="editaritem"
														update=":form:dlg2" icon="fa fa-edit" styleClass="btn-warning btn-xs" >
														<f:setPropertyActionListener value="#{items}"
															target="#{beanEditaProjeto.item}" />
													</p:commandButton>
													<p:tooltip for="editaritem" value="Editar Item da Etapa" position="right" showEffect="clip" hideEffect="fold"/>
													
													<p:commandButton ajax="false" immediate="true" partialSubmit="true" styleClass=" bg-olive btn-xs" id="subirnivel"
														process="@this" icon="fa fa-level-up"  actionListener="#{beanEditaProjeto.altonivel(items)}" />	
														<p:tooltip for="subirnivel" value="Subir na Ordem" position="right" showEffect="clip" hideEffect="fold"/>
													
													<p:commandButton ajax="false" immediate="true" partialSubmit="true" styleClass=" bg-purple btn-xs" id="descernivel"
														process="@this" icon="fa fa-level-down"  actionListener="#{beanEditaProjeto.baixonivel(items)}" />
														<p:tooltip for="descernivel" value="Descer na Ordem" position="right" showEffect="clip" hideEffect="fold"/>
															
												</p:column>
												
											</p:dataTable>
										</p:column>

									</p:dataTable>

								</h:panelGrid>
							</div>
						</div>
					</div>
					<p:separator></p:separator>
					
					<p:timeline id="timeline" style="font-style: italic;"
						value="#{beanEditaProjeto.timelineProjeto}" rendered="false"
						 widgetVar="timelineProjeto" axisOnTop="true" 
						start="#{beanEditaProjeto.projeto.dtinicio}"
						end="#{beanEditaProjeto.projeto.dtprevista}" locale="pt_BR" editable="false">
						
					</p:timeline>
			
					<p:separator></p:separator>
					
					<p:commandButton action="#{beanEditaProjeto.salvar()}" value="Salvar"
						icon="fa fa-check" styleClass="btn-primary" update="erros" />

					
					<p:dialog id="dlg" header="Etapa" widgetVar="dialogp"
						appendToBody="true" draggable="false" modal="true">
						<div class="box box-primary">
							<p:panelGrid id="painelDados" columns="2" layout="grid"
								styleClass="ui-fluid card">

								<p:outputLabel value="Nome:" for="enome" />
								<p:inputText id="enome" value="#{beanEditaProjeto.etapa.nome}" autocomplete="off"
									onkeyup="this.value=this.value.toUpperCase()" />

								<p:outputLabel value="Autoridade:" for="autoridade" />
								<p:inputText id="autoridade" autocomplete="off"
									value="#{beanEditaProjeto.etapa.autoridade}"
									onkeyup="this.value=this.value.toUpperCase()" />

								<p:outputLabel value="Responsabilidade:" for="responsabilidade" />
								<p:inputText id="responsabilidade" autocomplete="off"
									value="#{beanEditaProjeto.etapa.responsabilidade}"
									onkeyup="this.value=this.value.toUpperCase()" />

								<p:outputLabel value="Data Inicio:" for="edtinicio" />
								<p:calendar locale="pt_BR" id="edtinicio" readonlyInput="true"
									value="#{beanEditaProjeto.etapa.dtinicio}" pattern="dd/MM/yyyy"
									mask="true" mindate="#{beanEditaProjeto.projeto.dtinicio}" maxdate="#{beanEditaProjeto.projeto.dtprevista}">
								</p:calendar>

								<p:outputLabel value="Data Prevista:" for="edtprevista" />
								<p:calendar locale="pt_BR" id="edtprevista" readonlyInput="true"
									value="#{beanEditaProjeto.etapa.dtprevista}" pattern="dd/MM/yyyy"
									mask="true" mindate="#{beanEditaProjeto.projeto.dtinicio}" maxdate="#{beanEditaProjeto.projeto.dtprevista}">
								</p:calendar>

								<p:outputLabel value="Data Conclusão" for="edtconclusao" />
								<p:calendar locale="pt_BR" id="edtconclusao" disabled="true"
									value="#{beanEditaProjeto.etapa.dtconclusao}" pattern="dd/MM/yyyy"
									mask="true"  />

								<p:outputLabel value="Status:" for="estatus" />
								<p:inputText id="estatus" value="#{beanEditaProjeto.etapa.status}"
									required="true" disabled="true" />

							</p:panelGrid>

							<p:commandButton id="sle2" icon="fa fa-check"
								styleClass="btn-primary"
								action="#{beanEditaProjeto.editarsalvarEtapa()}" value="Salvar"
								ajax="false" update="erros">
							</p:commandButton>
						</div>
					</p:dialog>
					
					<p:dialog id="dlg2" header="Item da Etapa" widgetVar="dialogp2"
						appendToBody="true" draggable="false" modal="true">
						<div class="box box-primary">
							<p:panelGrid id="painelDados5" columns="2" layout="grid"
								styleClass="ui-fluid card">

								<p:outputLabel value="Responsavél:" for="responsavel" />
								<p:inputText id="responsavel" value="#{beanEditaProjeto.item.responsavel}" autocomplete="off"
									onkeyup="this.value=this.value.toUpperCase()" />

								<p:outputLabel value="Descrição:" for="eidescricao" />
								<p:inputText id="eidescricao" autocomplete="off"
									value="#{beanEditaProjeto.item.descricao}"
									onkeyup="this.value=this.value.toUpperCase()" />
									
								<p:outputLabel value="Custo Previsto:" for="valorprevisto" />
								<p:inputNumber id="valorprevisto" emptyValue="true"
								value="#{beanEditaProjeto.item.valorprevisto}" />
								
								<p:outputLabel value="Custo Real" for="valorconcluido" />
								<p:inputNumber id="valorconcluido" emptyValue="true"
								value="#{beanEditaProjeto.item.valorconcluido}" />		
									
								<p:outputLabel value="Data Inicio:" for="eidtinicio" />
								<p:calendar locale="pt_BR" id="eidtinicio" readonlyInput="true"
									value="#{beanEditaProjeto.item.dtinicio}" pattern="dd/MM/yyyy"
									mask="true" mindate="#{beanEditaProjeto.item.etapa.dtinicio}" maxdate="#{beanEditaProjeto.item.etapa.dtprevista}">
								</p:calendar>

								<p:outputLabel value="Data Prevista:" for="eidtprevista" />
								<p:calendar locale="pt_BR" id="eidtprevista" readonlyInput="true"
									value="#{beanEditaProjeto.item.dtprevista}" pattern="dd/MM/yyyy"
									mask="true" mindate="#{beanEditaProjeto.item.etapa.dtinicio}" maxdate="#{beanEditaProjeto.item.etapa.dtprevista}">
								</p:calendar>

								<p:outputLabel value="Data Conclusão" for="eidtconclusao" />
								<p:calendar locale="pt_BR" id="eidtconclusao" disabled="true"
									value="#{beanEditaProjeto.item.dtconclusao}" pattern="dd/MM/yyyy"
									mask="true"  />

								<p:outputLabel value="Status:" for="eistatus" />
								<p:inputText id="eistatus" value="#{beanEditaProjeto.item.status}"
									required="true" disabled="true" />	
									
								<p:outputLabel value="Status Observação" for="statusobservacao" />
								<p:inputText id="statusobservacao" autocomplete="off"
									value="#{beanEditaProjeto.item.statusobservacao}"
									onkeyup="this.value=this.value.toUpperCase()" />	

							</p:panelGrid>
							<p:commandButton id="sle3" icon="fa fa-check"
								styleClass="btn-primary"
								action="#{beanEditaProjeto.editarsalvarEtapaItem()}" value="Salvar"
								ajax="false" update="erros">
							</p:commandButton>
						</div>
					</p:dialog>
					
				</div>
			</h:form>
		</p:panel>
	</ui:define>

</ui:composition>